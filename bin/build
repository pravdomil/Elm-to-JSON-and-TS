#!/usr/bin/env bash

# To stop if any command fails.
set -e

# To stop on unset variables.
set -u

# To be in project root.
cd "${0%/*}/.."

# To compile our app.
elm make src/Main.elm --output bin/elm-json-interop.js --optimize
elm-ffi --shebang --run bin/elm-json-interop.js
mv bin/elm-json-interop.js bin/elm-json-interop
chmod +x bin/elm-json-interop

# To build example.
bin/elm-json-interop example/src/Msg/Msg.elm
bin/elm-json-interop example/src/User/User.elm
elm-format --yes example/src/Msg/*.elm
elm-format --yes example/src/User/*.elm
(cd example/src && printf "import Test\nTest.test" | elm repl)
